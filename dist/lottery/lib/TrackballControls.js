THREE.TrackballControls=function(e,t){var o,n,i,s,c,a,r,p,h,d,E,u,m=this,l={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var g=new THREE.Vector3,y=l.NONE,v=l.NONE,w=new THREE.Vector3,T=new THREE.Vector2,f=new THREE.Vector2,b=new THREE.Vector3,R=0,O=new THREE.Vector2,H=new THREE.Vector2,L=0,V=0,N=new THREE.Vector2,j=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var D={type:"change"},k={type:"start"},A={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};var C=(o=new THREE.Vector2,function(e,t){return o.set((e-m.screen.left)/m.screen.width,(t-m.screen.top)/m.screen.height),o});var P=(n=new THREE.Vector2,function(e,t){return n.set((e-.5*m.screen.width-m.screen.left)/(.5*m.screen.width),(m.screen.height+2*(m.screen.top-t))/m.screen.width),n});function X(e){if(!1!==m.enabled){if(window.removeEventListener("keydown",X),v=y,y===l.NONE)e.keyCode!==m.keys[l.ROTATE]||m.noRotate?e.keyCode!==m.keys[l.ZOOM]||m.noZoom?e.keyCode===m.keys[l.PAN]&&!m.noPan&&(y=l.PAN):y=l.ZOOM:y=l.ROTATE}}function Y(e){!1!==m.enabled&&(y=v,window.addEventListener("keydown",X,!1))}function M(e){!1!==m.enabled&&(e.preventDefault(),e.stopPropagation(),y===l.NONE&&(y=e.button))}function S(e){!1!==m.enabled&&(e.preventDefault(),e.stopPropagation(),y!==l.ROTATE||m.noRotate?y!==l.ZOOM||m.noZoom?y===l.PAN&&!m.noPan&&j.copy(C(e.pageX,e.pageY)):H.copy(C(e.pageX,e.pageY)):(T.copy(f),f.copy(P(e.pageX,e.pageY))))}function x(e){!1!==m.enabled&&(e.preventDefault(),e.stopPropagation(),y=l.NONE,document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",x),m.dispatchEvent(A))}function Z(e){if(!1!==m.enabled)!0!==m.noZoom&&(e.preventDefault(),e.stopPropagation())}function z(e){if(!1!==m.enabled){if(e.preventDefault(),1===e.touches.length)y=l.TOUCH_ROTATE,f.copy(P(e.touches[0].pageX,e.touches[0].pageY)),T.copy(f);else{y=l.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;V=L=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;N.copy(C(n,i)),j.copy(N)}m.dispatchEvent(k)}}function _(e){if(!1!==m.enabled){if(e.preventDefault(),e.stopPropagation(),1===e.touches.length)T.copy(f),f.copy(P(e.touches[0].pageX,e.touches[0].pageY));else{var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;V=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;j.copy(C(n,i))}}}function q(e){if(!1!==m.enabled){switch(e.touches.length){case 0:y=l.NONE;break;case 1:y=l.TOUCH_ROTATE,f.copy(P(e.touches[0].pageX,e.touches[0].pageY)),T.copy(f)}m.dispatchEvent(A)}}function F(e){!1!==m.enabled&&e.preventDefault()}this.rotateCamera=(s=new THREE.Vector3,c=new THREE.Quaternion,a=new THREE.Vector3,r=new THREE.Vector3,p=new THREE.Vector3,h=new THREE.Vector3,function(){h.set(f.x-T.x,f.y-T.y,0),(i=h.length())?(w.copy(m.object.position).sub(m.target),a.copy(w).normalize(),r.copy(m.object.up).normalize(),p.crossVectors(r,a).normalize(),r.setLength(f.y-T.y),p.setLength(f.x-T.x),h.copy(r.add(p)),s.crossVectors(h,w).normalize(),i*=m.rotateSpeed,c.setFromAxisAngle(s,i),w.applyQuaternion(c),m.object.up.applyQuaternion(c),b.copy(s),R=i):!m.staticMoving&&R&&(R*=Math.sqrt(1-m.dynamicDampingFactor),w.copy(m.object.position).sub(m.target),c.setFromAxisAngle(b,R),w.applyQuaternion(c),m.object.up.applyQuaternion(c)),T.copy(f)}),this.zoomCamera=function(){var e;y===l.TOUCH_ZOOM_PAN?(e=L/V,L=V,w.multiplyScalar(e)):(1!=(e=1+(H.y-O.y)*m.zoomSpeed)&&e>0&&w.multiplyScalar(e),m.staticMoving?O.copy(H):O.y+=(H.y-O.y)*this.dynamicDampingFactor)},this.panCamera=(d=new THREE.Vector2,E=new THREE.Vector3,u=new THREE.Vector3,function(){d.copy(j).sub(N),d.lengthSq()&&(d.multiplyScalar(w.length()*m.panSpeed),u.copy(w).cross(m.object.up).setLength(d.x),u.add(E.copy(m.object.up).setLength(d.y)),m.object.position.add(u),m.target.add(u),m.staticMoving?N.copy(j):N.add(d.subVectors(j,N).multiplyScalar(m.dynamicDampingFactor)))}),this.checkDistances=function(){(!m.noZoom||!m.noPan)&&(w.lengthSq()>m.maxDistance*m.maxDistance&&(m.object.position.addVectors(m.target,w.setLength(m.maxDistance)),O.copy(H)),w.lengthSq()<m.minDistance*m.minDistance&&(m.object.position.addVectors(m.target,w.setLength(m.minDistance)),O.copy(H)))},this.update=function(){w.subVectors(m.object.position,m.target),!m.noRotate&&m.rotateCamera(),!m.noZoom&&m.zoomCamera(),!m.noPan&&m.panCamera(),m.object.position.addVectors(m.target,w),m.checkDistances(),m.object.lookAt(m.target),g.distanceToSquared(m.object.position)>1e-6&&(m.dispatchEvent(D),g.copy(m.object.position))},this.reset=function(){y=l.NONE,v=l.NONE,m.target.copy(m.target0),m.object.position.copy(m.position0),m.object.up.copy(m.up0),w.subVectors(m.object.position,m.target),m.object.lookAt(m.target),m.dispatchEvent(D),g.copy(m.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",F,!1),this.domElement.removeEventListener("mousedown",M,!1),this.domElement.removeEventListener("wheel",Z,!1),this.domElement.removeEventListener("touchstart",z,!1),this.domElement.removeEventListener("touchend",q,!1),this.domElement.removeEventListener("touchmove",_,!1),document.removeEventListener("mousemove",S,!1),document.removeEventListener("mouseup",x,!1),window.removeEventListener("keydown",X,!1),window.removeEventListener("keyup",Y,!1)},this.domElement.addEventListener("contextmenu",F,!1),this.domElement.addEventListener("mousedown",M,!1),this.domElement.addEventListener("wheel",Z,!1),this.domElement.addEventListener("touchstart",z,!1),this.domElement.addEventListener("touchend",q,!1),this.domElement.addEventListener("touchmove",_,!1),window.addEventListener("keydown",X,!1),window.addEventListener("keyup",Y,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;