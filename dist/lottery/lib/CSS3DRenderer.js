THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(){console.log("THREE.CSS3DRenderer",THREE.REVISION);var e,t,r,n,a,o,i=new THREE.Matrix4,s={camera:{fov:0,style:""},objects:new WeakMap},l=document.createElement("div");l.style.overflow="hidden",this.domElement=l;var c=document.createElement("div");c.style.WebkitTransformStyle="preserve-3d",c.style.transformStyle="preserve-3d",l.appendChild(c);var p=/Trident/i.test(navigator.userAgent);function d(e){return 1e-10>Math.abs(e)?0:e}function m(e){var t=e.elements;return"matrix3d("+d(t[0])+","+d(-t[1])+","+d(t[2])+","+d(t[3])+","+d(t[4])+","+d(-t[5])+","+d(t[6])+","+d(t[7])+","+d(t[8])+","+d(-t[9])+","+d(t[10])+","+d(t[11])+","+d(t[12])+","+d(-t[13])+","+d(t[14])+","+d(t[15])+")"}function E(e,t){var r=e.elements,n="matrix3d("+d(r[0])+","+d(r[1])+","+d(r[2])+","+d(r[3])+","+d(-r[4])+","+d(-r[5])+","+d(-r[6])+","+d(-r[7])+","+d(r[8])+","+d(r[9])+","+d(r[10])+","+d(r[11])+","+d(r[12])+","+d(r[13])+","+d(r[14])+","+d(r[15])+")";return p?"translate(-50%,-50%)translate("+a+"px,"+o+"px)"+t+n:"translate(-50%,-50%)"+n}this.getSize=function(){return{width:r,height:n}},this.setSize=function(e,t){r=e,n=t,a=r/2,o=n/2,l.style.width=e+"px",l.style.height=t+"px",c.style.width=e+"px",c.style.height=t+"px"};var S=(e=new THREE.Vector3,t=new THREE.Vector3,function(r,n){return e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(n.matrixWorld),e.distanceToSquared(t)});this.render=function(e,t){var r=t.projectionMatrix.elements[5]*o;if(s.camera.fov!==r&&(t.isPerspectiveCamera&&(l.style.WebkitPerspective=r+"px",l.style.perspective=r+"px"),s.camera.fov=r),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.isOrthographicCamera){var n=-(t.right+t.left)/2,h=(t.top+t.bottom)/2}var u=t.isOrthographicCamera?"scale("+r+")translate("+d(n)+"px,"+d(h)+"px)"+m(t.matrixWorldInverse):"translateZ("+r+"px)"+m(t.matrixWorldInverse),f=u+"translate("+a+"px,"+o+"px)";s.camera.style!==f&&!p&&(c.style.WebkitTransform=f,c.style.transform=f,s.camera.style=f),!function e(t,r,n){if(t instanceof THREE.CSS3DObject){t instanceof THREE.CSS3DSprite?(i.copy(r.matrixWorldInverse),i.transpose(),i.copyPosition(t.matrixWorld),i.scale(t.scale),i.elements[3]=0,i.elements[7]=0,i.elements[11]=0,i.elements[15]=1,a=E(i,n)):a=E(t.matrixWorld,n);var a,o=t.element,l=s.objects.get(t);if(void 0===l||l.style!==a){o.style.WebkitTransform=a,o.style.transform=a;var d={style:a};p&&(d.distanceToCameraSquared=S(r,t)),s.objects.set(t,d)}o.parentNode!==c&&c.appendChild(o)}for(var m=0,h=t.children.length;m<h;m++)e(t.children[m],r,n)}(e,t,u),p&&!function(e){for(var t,r=(t=[],e.traverse(function(e){e instanceof THREE.CSS3DObject&&t.push(e)}),t).sort(function(e,t){return s.objects.get(e).distanceToCameraSquared-s.objects.get(t).distanceToCameraSquared}),n=r.length,a=0,o=r.length;a<o;a++)r[a].element.style.zIndex=n-a}(e)}};